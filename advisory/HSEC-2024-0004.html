<!DOCTYPE HTML><html><html lang="en"><head><meta charset="UTF-8"><base href=".."><link rel="alternate" type="application/atom+xml" href="https://haskell.github.io/security-advisories/atom.xml"><link rel="stylesheet" href="assets/css/default.css"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Haskell Security advisories"><title>Haskell Security advisories</title></head><body><div class="nav-bar"><ul class="items"><li class><a href="by-dates.html">by date</a></li><li class><a href="by-packages.html">by package</a></li></ul></div><h1>HSEC-2024-0004</h1><div class="content"><div id="advisory"><h1>Hackage package and doc upload stored XSS vulnerability</h1>
<p><em>Author: Fraser Tweedale (Haskell SRT)</em></p>
<h2>Executive summary</h2>
<p>A <strong>critical XSS vulnerability</strong> affected
<em>hackage-server</em> and <code>hackage.haskell.org</code>. HTML and
JavaScript files provided in source packages or via the documentation
upload facility were served <em>as-is</em> on the main
<code>hackage.haskell.org</code> domain. As a consequence, when a user
with latent HTTP credentials browses to the package pages or
documentation uploaded by a malicious package maintainer, their
<strong>session can be hijacked</strong> to upload packages or
documentation, amend maintainers or other package metadata, or perform
any other action the user is authorised to do.</p>
<p>This issue was discovered and reported to the Haskell Security
Response Team (SRT) in June 2024. Remediations were progressively
developed and deployed throughout 2025. <strong>The known issues have
been fully mitigated on <code>hackage.haskell.org</code> as of January
2026.</strong></p>
<p>The mitigations involve serving user content from a sister domain. In
the case of <code>hackage.haskell.org</code>, this domain is
<code>hackage-content.haskell.org</code>.</p>
<p>Operators of other <em>hackage-server</em> instances should update to
the <code>master</code> branch from the upstream repository
(https://github.com/haskell/hackage-server; commit
<code>9a1887607d9b8d1a3b8b02c990ee144c0d402b79</code> or later), and
configure the user content domain (new flag
<code>--user-content-uri</code>).</p>
<h2>Scope of the issue</h2>
<h3>Package documentation uploads</h3>
<p>Any Hackage user can upload documentation bundles for the packages
they own. Typically those are prepared by Haddock, but they may be
customised or modified. Malicious code can be delivered in several
ways:</p>
<ul>
<li>In JavaScript files loaded by an HTML page;</li>
<li>In <code>&lt;script&gt;</code> tags on an HTML page;</li>
<li>In action attributes (e.g. <code>onclick</code>) on an HTML
page.</li>
</ul>
<h3><code>quick-jump</code> JavaScript</h3>
<p>In addition to the supplied HTML pages, parts of the uploaded
documentation bundle are referenced from the main package page (and
candidate pages)—in particular, <code>quick-jump.min.js</code>, which
implements the "quick jump" feature, and the corresponding CSS file (CSS
can also present an XSS risk). These files are included by the following
templates:</p>
<ul>
<li><code>datafiles/templates/Html/package-page.html.st</code></li>
<li><code>datafiles/templates/Html/candidate-page.html.st</code></li>
</ul>
<p>It is loaded via a <code>&lt;script&gt;</code> tag:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;$doc.baseUrl$/quick-jump.min.js&quot;</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h3>Source tarball browsing</h3>
<p>HTML content in the source package is served as
<code>text/html</code> or <code>application/xhtml+xml</code>, depending
on file extension. The browser renders the page and executes scripts
without restriction. The same scope of exploitation arises as for
documentation uploads.</p>
<h2>Impact</h2>
<p>Malicious scripts can use latent HTTP credentials in the browser to
perform any action the user is authorised to do, <strong>without user
interaction</strong>. This could include uploading new package versions,
editing packaging metadata, adding new maintainers, and more.</p>
<p>Additionally, malicious scripts and HTML could present a counterfeit
login form to the user, tricking the user into divulging their
credentials. The script can then abuse the credentials in the same way
as the latent credential scenario.</p>
<ul>
<li>CVSS vector string:
<strong>CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:L</strong></li>
<li>CVSS score: <strong>9.9 (Critical)</strong></li>
</ul>
<h2>Mitigations</h2>
<p>This section describes the code and configuration changes to mitigate
the issues.</p>
<h3>User content domain</h3>
<p><em>hackage-server</em> was updated to serve user-uploaded content
from a separate DNS domain. This includes package documentation
(excluding the main package description) and source tarball browsing,
for both published and candidate packages.</p>
<p>For the relevant resources, requests on the main domain are
redirected to the user content domain via an HTTP 301 ("Moved
Permanently") response status.</p>
<p>Doc and source tarballs uploaded prior to the deployment of these
mitigations are exempted from the redirection, and remain accessible via
the main domain (this may be changed in the future).</p>
<p>Alternative approaches considered:</p>
<ul>
<li>Serving HTML from the source tarball with
<code>Content-Type: text/plain</code> would prevent the browser from
interpreting them as HTML and executing inline or referenced scripts.
But several packages have custom doc bundles uploaded, offering a rich
documentation experience to their users. Therefore, changing this
behaviour would surprise and probably disappoint many users.</li>
</ul>
<h3>quick-jump: reject unrecognised JavaScript and CSS</h3>
<p>A small number of versions of <code>quick-jump.min.js</code> and
<code>quick-jump.css</code> have appeared in official releases of of the
Haddock documentation builder program. <em>hackage-server</em> matches
the SHA-256 digests of the files in the doc bundle against the list of
"known good" files. If there is no match, <em>hackage-server</em>
refuses to serve the file (403 Forbidden).</p>
<p>The digest lists are currently hard-coded; the initial values are
mentioned at the end of this document. The list needs to be updated
whenever the official Haddock quick-jump implementation changes.</p>
<p>Alternative approaches considered:</p>
<ul>
<li><p>Using <a href="https://www.w3.org/TR/SRI/"><em>Subresource
Integrity (SRI)</em></a> to limit to known-good hashes. This would
require the same amount of development and maintenance overhead whilst
depending on browser implementation for enforcement.</p></li>
<li><p>Ignoring the quick-jump implementation from the doc bundle and
serving a single "golden" implementation for all packages. Because
quick-jump reads the generated <code>doc-index.json</code> this approach
ran the risk of breaking the feature on older (or newer) uploads if the
format of the file changes. Formally specifying the
<code>doc-index.json</code> would allow the quick-jump feature to be
evolved and improved to bring benefits to all packages and reduce
security risks.</p></li>
</ul>
<p>There was considerable debate between the digest allow-list and
"golden" approaches. The <em>hackage-server</em> maintainers had the
final say, and the SRT is satisfied that the chosen approach resolves
the security issues.</p>
<h2>Acknowledgements</h2>
<ul>
<li><strong>Zubin Duggal</strong> reported the issue in documentation
uploads.</li>
<li><strong>Duncan Coutts</strong> noticed that the issue also affects
source tarball browsing.</li>
<li><strong>Gershom Bazerman</strong> and <strong>Janus
Troelsen</strong> implemented the mitigations, and Gershom handled
redeploys of the <code>hackage.haskell.org</code> service.</li>
<li><strong>Fraser Tweedale</strong> verified and analysed the issue,
and coordinated the security response.</li>
</ul>
<h2>Appendix A.1. Known-good variants of
<code>quick-jump.min.js</code></h2>
<p>This appendix records known variants of
<code>quick-jump.min.js</code> from the GHC and Haddock repositories.
The commit ID, Git object (short) ID, and SHA-256 digests are noted. The
SHA-256 digests can be used with Subresource Integrity (SRI) or
server-side checks to prevent delivery or execution of unrecognised
script content.</p>
<h3>From
<code>https://gitlab.haskell.org/ghc/haddock.git</code>—<code>master</code>
branch</h3>
<pre><code>commit: e99aefb50ca63e2dbcc95841efbb53cea90151d8 (Sep 23 2017)
object: c9f2b445b9
sha256: e1da96b0d7ab3d72cfe3786def923c5af91ba331858852f1f43a1acfc5ee6966

commit: 8e88615a23a9f1980a55bd1b3ef9dcc938d95237 (Oct 10 2017)
object: cb24f8bdea
sha256: a273a3ef19c21032afc5f65d1e09933146f183da906ca9d0b4c285095539e0e7

commit: b4982d87f41d9a4d3f6237bacfd819145723e35b (Oct 30 2017)
object: f22f8f2881
sha256: 8aed621ac2b746751585cbe271631394cacc0e01cca4ef589e11b077b0acd291

commit: 93c1e6eb9e829a66ff213ec076d529ab008880b3 (Dec 16 2017)
object: bfdf04a372
sha256: 4b10c18a7ad35f032e8cdc0d263716a93878bf06d998b1b66dccff06ceeee89d

commit: 59812a09eb69cbf12407206381f4c214987b1efd (Apr 3 2018)
object: c03e083607
sha256: ce86bba43edb0534c0faa2d6d0f504877576c5271321e3fbd9638fd4667384a2

commit: a69311708493efe8524aed0e9d19365f79f2fab3 (Oct 24 2018)
object: 06c35c7454
sha256: 548d676b3e5a52cbfef06d7424ec065c1f34c230407f9f5dc002c27a9666bec4</code></pre>
<h3>From
<code>https://gitlab.haskell.org/ghc/ghc.git</code>—<code>master</code>
branch</h3>
<p>Note: all of the <em>objects</em> listed above also occur in the GHC
repo, but the commit history is different (as expected).</p>
<pre><code>commit: 7776566531e72c415f66dd3b13da9041c52076aa (Nov 13 2019)
object: 0b0eeb27d1
sha256: 7ca43fc2058574846e032bc5493a0ad4568e4fa14fb58558fbf48d3bd6693e59

commit: 14e554cf682ae975ba356b07672c0f9d465e2a78 (May 24 2024)
object: 06c35c7454
sha256: (seen already)</code></pre>
<h2>Appendix A.2. Known-good variants of
<code>quick-jump.css</code></h2>
<p>This appendix records known variants of <code>quick-jump.css</code>
from the GHC and Haddock repositories. The commit ID, Git object (short)
ID, and SHA-256 digests are noted. The SHA-256 digests can be used with
Subresource Integrity (SRI) or server-side checks to prevent delivery or
use of unrecognised CSS content.</p>
<h3>From
<code>https://gitlab.haskell.org/ghc/haddock.git</code>—<code>master</code>
branch</h3>
<p><em>No changes since integration of haddock into the ghc
repo</em>.</p>
<h3>From
<code>https://gitlab.haskell.org/ghc/ghc.git</code>—<code>master</code>
branch</h3>
<pre><code>commit: 9511e587701349093cbe3ac7c00f13583820774f (Feb 7 2021)
object: cf10eee4
sha256: 6bd159f6d7b1cfef1bd190f1f5eadcd15d35c6c567330d7465c3c35d5195bc6f

commit: 05ccce6e07731f9788a434d6e06f4cadeff3d6ba (Dec 8 2020)
object: d656f51c
sha256: 6997c223e09b340f5f1bb970c930b458f768a0bbbe787cb87f181820a3d122b3

commit: fa5ec121e2a700137bab8bd48cc30b1e80f58fd4 (Feb 27 2019)
object: 8772809c
sha256: 29fe483bd37ad3feba12f646e9661731127526f246c246b0011b384e11649dff

commit: fc069bf200f930c21f96ddbbec1d7c5c69f8ba72 (Jan 15 2018)
object: 468d8036
sha256: 1d51573b72bc8a7b9b0dda3beffb7882db78d22a37840203f761e3969d915027

commit: 0997eb61803a37803ddb6cf7116eb9db1046b2ce (Oct 10 2017)
object: ede05042
sha256: 59693ef3f0d793031b3af58b214af7884c0f63ce6db659ffd7432cf0aa852b51

commit: d41abb0f606bf5fdbdc0a7bd3758e0c30601b121 (Sep 23 2017)
object: b69903c3
sha256: f95b8b12a8a13dd31add93527e1239fdff6997c7f2396e975e2e415db04b75fb</code></pre><h3>Info</h3><dl><dt>Published</dt><dd>January 16, 2026</dd><dt>Modified</dt><dd>January 16, 2026</dd><dt>CAPECs</dt><dd><i>&lt; none &gt;</i></dd><dt>CWEs</dt><dd><a href="https://cwe.mitre.org/data/definitions/829.html">829</a></dd><dt>Keywords</dt><dd>hackage, xss, supply-chain</dd><dt>Aliases</dt><dd><i>&lt; none &gt;</i></dd><dt>Related</dt><dd><i>&lt; none &gt;</i></dd><dt>References</dt><dd><a href="https://github.com/haskell/hackage-server/commit/5a0dc3357b042502fcf684ed7e2464fde1407809">[FIX] https://github.com/haskell/hackage-server/commit/5a0dc3357b042502fcf684ed7e2464fde1407809</a></dd><dd><a href="https://github.com/haskell/hackage-server/commit/33d9ea3de9a298b21b53ba23386af2742384e627">[FIX] https://github.com/haskell/hackage-server/commit/33d9ea3de9a298b21b53ba23386af2742384e627</a></dd><dd><a href="https://github.com/haskell/hackage-server/commit/354a7de3b7f21ad1346677df515d8e8ec75016e6">[FIX] https://github.com/haskell/hackage-server/commit/354a7de3b7f21ad1346677df515d8e8ec75016e6</a></dd></dl><h4>Affected</h4><h5><a href="https://hackage.haskell.org/package/hackage-server"><code>@hackage/hackage-server</code></a></h5><dl><dt>CVSS</dt><dd>CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:L</dd><dt>Versions</dt><dd><code>&gt;=0.1 &amp;&amp; &lt;0.6</code></dd><dt>Declarations</dt><dd><i>&lt; none &gt;</i></dd></dl></div></div><footer><div class="HF">This site is a project of <a href="https://haskell.foundation" target="_blank" rel="noopener noreferrer">The Haskell Foundation</a>.</div></footer></body></html></html>