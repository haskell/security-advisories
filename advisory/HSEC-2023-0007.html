<!DOCTYPE HTML><html><html lang="en"><head><meta charset="UTF-8"><base href=".."><link rel="alternate" type="application/atom+xml" href="https://haskell.github.io/security-advisories/atom.xml"><link rel="stylesheet" href="assets/css/default.css"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Haskell Security advisories"><title>Haskell Security advisories</title></head><body><div class="nav-bar"><ul class="items"><li class><a href="by-dates.html">by date</a></li><li class><a href="by-packages.html">by package</a></li></ul></div><h1>HSEC-2023-0007</h1><div class="content"><div id="advisory"><h1><code>readFloat</code>: memory exhaustion with large exponent</h1>
<p><code>Numeric.readFloat</code> takes time and memory linear in the
size of the number <em>denoted</em> by the input string. In particular,
processing a number expressed in scientific notation with a very large
exponent could cause a denial of service. The slowdown is observable on
a modern machine running GHC 9.4.4:</p>
<pre><code>ghci&gt; import qualified Numeric
ghci&gt; Numeric.readFloat &quot;1e1000000&quot;    -- near instantaneous
[(Infinity,&quot;&quot;)]
ghci&gt; Numeric.readFloat &quot;1e10000000&quot;   -- perceptible pause
[(Infinity,&quot;&quot;)]
ghci&gt; Numeric.readFloat &quot;1e100000000&quot;  -- ~ 3 seconds
[(Infinity,&quot;&quot;)]
ghci&gt; Numeric.readFloat &quot;1e1000000000&quot; -- ~ 35 seconds
[(Infinity,&quot;&quot;)]</code></pre>
<h2>In <em>base</em></h2>
<p><code>Numeric.readFloat</code> is defined for all
<code>RealFrac a =&gt; a</code>:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readFloat</span><span class="ot"> ::</span> <span class="dt">RealFrac</span> a <span class="ot">=&gt;</span> <span class="dt">ReadS</span> a</span></code></pre></div>
<p>The <code>RealFrac</code> type class does not express any bounds on
the size of values representable in the types for which instances exist,
so bounds checking is not possible (in this <em>generic</em> function).
<code>readFloat</code> uses to
<code>Text.Read.Lex.numberToRational</code> which, among other things,
calculates <code>10 ^ exponent</code>, which seems to take linear time
and memory.</p>
<p><strong>Mitigation:</strong> use <code>read</code>. The
<code>Read</code> instances for <code>Float</code> and
<code>Double</code> perform bounds checks on the exponent, via
<code>Text.Read.Lex.numberToRangedRational</code>.</p>
<h2>In <em>toml-reader</em></h2>
<p>The issue was detected in <em>toml-reader</em> version 0.1.0.0, and
mitigated in version 0.2.0.0 by immediately returning
<code>Infinity</code> when the exponent is large enough that there's no
reason to process it.</p><h3>Info</h3><dl><dt>Published</dt><dd>July 22, 2023</dd><dt>Modified</dt><dd>July 22, 2023</dd><dt>CAPECs</dt><dd><i>&lt; none &gt;</i></dd><dt>CWEs</dt><dd><a href="https://cwe.mitre.org/data/definitions/1284.html">1284</a></dd><dd><a href="https://cwe.mitre.org/data/definitions/789.html">789</a></dd><dt>Keywords</dt><dd>toml, parser, dos</dd><dt>Aliases</dt><dd><i>&lt; none &gt;</i></dd><dt>Related</dt><dd><i>&lt; none &gt;</i></dd><dt>References</dt><dd><a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23538">[REPORT] https://gitlab.haskell.org/ghc/ghc/-/issues/23538</a></dd><dd><a href="https://github.com/brandonchinn178/toml-reader/issues/8">[REPORT] https://github.com/brandonchinn178/toml-reader/issues/8</a></dd><dd><a href="https://github.com/brandonchinn178/toml-reader/pull/9">[FIX] https://github.com/brandonchinn178/toml-reader/pull/9</a></dd></dl><h4>Affected</h4><h5><a href="https://hackage.haskell.org/package/base"><code>base</code></a></h5><dl><dt>CVSS</dt><dd>CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H</dd><dt>Versions</dt><dd><code>&gt;=3.0.3.1</code></dd><dt>Declarations</dt><dd><i>&lt; none &gt;</i></dd></dl><h5><a href="https://hackage.haskell.org/package/toml-reader"><code>toml-reader</code></a></h5><dl><dt>CVSS</dt><dd>CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H</dd><dt>Versions</dt><dd><code>&gt;=0.1.0.0 &amp;&amp; &lt;0.2.0.0</code></dd><dt>Declarations</dt><dd><i>&lt; none &gt;</i></dd></dl></div></div><footer><div class="HF">This site is a project of <a href="https://haskell.foundation" target="_blank" rel="noopener noreferrer">The Haskell Foundation</a>.</div></footer></body></html></html>