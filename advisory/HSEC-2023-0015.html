<!DOCTYPE HTML><html><html lang="en"><head><meta charset="UTF-8"><base href=".."><link rel="alternate" type="application/atom+xml" href="https://haskell.github.io/security-advisories/atom.xml"><link rel="stylesheet" href="assets/css/default.css"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Haskell Security advisories"><title>Haskell Security advisories</title></head><body><div class="nav-bar"><ul class="items"><li class><a href="by-dates.html">by date</a></li><li class><a href="by-packages.html">by package</a></li></ul></div><h1>HSEC-2023-0015</h1><div class="content"><div id="advisory"><h1>cabal-install uses expired key policies</h1>
<p>A problem was recently discovered in <code>cabal-install</code>'s
implementation of the Hackage Security protocol that would allow an
attacker who was in possession of a revoked private key and who could
perform a man-in-the-middle attack against Hackage to use the revoked
key to deliver malicious packages. At this time, this is only a
theoretical attack - no keys have been revoked. Release 3.10.2.0 of
<code>cabal-install</code> contains a fix for this bug, and we have
contacted distributors of older versions (such as Linux distributions)
with a patch that they can apply.</p>
<h2>Background</h2>
<p>Hackage Security is an implementation of <a
href="https://theupdateframework.io/">The Update Framework</a>, which is
a design for a package repository that allows untrusted mirrors without
undermining software supply-chain security. In particular, Hackage
Security cryptographically guarantees the following properties:</p>
<ul>
<li><p>Mirrors of Hackage cannot change the contents of packages. This
prevents the insertion of malicious code.</p></li>
<li><p>Mirrors cannot omit newer packages for more than a few days
without clients noticing. This ensures both that mirrors cannot
maliciously deny security updates, and that mistakes in their
configuration will be noticed.</p></li>
</ul>
<p>Hackage has a <a href="https://hackage.haskell.org/root.json">key
policy file</a> that delegates authority to a number of private keys for
various purposes. Most of the keys are kept securely offline by trusted
community members who annually re-sign the various files to indicate
that they still have confidence in Hackage's policies. However, to
prevent clients from being denied updates, Hackage has an automated
process that periodically re-signs a timestamp file. This signature has
a short expiry. Additionally, a snapshot file contains signed hashes of
the Hackage index that is updated on each package upload. The timestamp
and snapshot private keys are held in memory on the Hackage server.
These are called the operational keys. If an operational key is ever
compromised, then it will be revoked by having the Hackage root
keyholders sign a new key policy file. To prevent replay attacks,
clients that connect to Hackage after this update will reject older
policy files, based on a monotonically increasing file version
number.</p>
<p>If a client has not yet received the updated policy file (for
example, because they have a fresh install of <code>cabal-install</code>
or because they have not run <code>cabal update</code> in some time),
the built-in expiration date in the file limits the window of exposure
in which the revoked operational keys would be expected. As long as the
root keys have not been compromised, the compromised operational keys
can only be used until the policy file expires. In addition to
compromising a Hackage operational key, an attacker would additionally
need to either compromise a Hackage mirror or perform a
man-in-the-middle attack against the target in order to serve a
malicious or obsolete package index.</p>
<h2>The Issue</h2>
<p>A bug in <code>cabal-install</code> caused it to skip the
verification of the key policy file's expiration timestamp. This means
that users of older, unpatched versions of <code>cabal-install</code>
could be vulnerable to a malicious mirror or man-in-the-middle attack
against Hackage if they have not connected to Hackage in a long time,
even after the policy file has expired.</p>
<p>We do not believe that it has been possible to exploit this
vulnerability, because no operational keys have been revoked. However,
in case key revocation occurs, we strongly advise all users of
<code>cabal-install</code> to ensure that they have version 3.10.2.0 or
newer, which contain the fix.</p><h3>Info</h3><dl><dt>Published</dt><dd>November 07, 2023</dd><dt>Modified</dt><dd>November 07, 2023</dd><dt>CAPECs</dt><dd><i>&lt; none &gt;</i></dd><dt>CWEs</dt><dd><a href="https://cwe.mitre.org/data/definitions/672.html">672</a></dd><dt>Keywords</dt><dd>hackage, mitm, supply-chain</dd><dt>Aliases</dt><dd><i>&lt; none &gt;</i></dd><dt>Related</dt><dd><i>&lt; none &gt;</i></dd><dt>References</dt><dd><a href="https://github.com/haskell/cabal/issues/8918#issuecomment-1521096581">[REPORT] https://github.com/haskell/cabal/issues/8918#issuecomment-1521096581</a></dd><dd><a href="https://github.com/haskell/cabal/commit/dcfdc9cffd74cade4e8cf3df37c5993413ffd30f">[FIX] https://github.com/haskell/cabal/commit/dcfdc9cffd74cade4e8cf3df37c5993413ffd30f</a></dd></dl><h4>Affected</h4><h5><a href="https://hackage.haskell.org/package/cabal-install"><code>cabal-install</code></a></h5><dl><dt>CVSS</dt><dd>CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:N/I:H/A:N</dd><dt>Versions</dt><dd><code>&gt;=1.24.0.0 &amp;&amp; &lt;3.10.2.0</code></dd><dt>Declarations</dt><dd><i>&lt; none &gt;</i></dd></dl></div></div><footer><div class="HF">This site is a project of <a href="https://haskell.foundation" target="_blank" rel="noopener noreferrer">The Haskell Foundation</a>.</div></footer></body></html></html>